<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é¦–çˆ¾æ—…éŠæ”»ç•¥ V15 - 2026æ˜¥å­£ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        :root { --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom); --primary-brown: #A68F80; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #FDFBF9; color: #5D4E46; margin: 0; padding: 0; overflow: hidden; }
        header { padding-top: calc(1rem + var(--safe-top)); background: #EBE3DB; border-bottom: 1px solid #D9CFC7; text-align: center; padding-bottom: 1rem; }
        .main-scroll-area { height: calc(100vh - 160px - var(--safe-top) - var(--safe-bottom)); overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 1rem; padding-bottom: 100px; }
        .tab-content { display: none; }
        .active-content { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .active-tab { color: #8A7A70 !important; border-bottom: 2px solid var(--primary-brown); }
        .cream-card { background: white; border: 1px solid #EBE3DB; border-radius: 1.25rem; padding: 1.25rem; box-shadow: 0 4px 12px rgba(232, 222, 213, 0.05); margin-bottom: 1rem; }
        .day-header { border-left: 4px solid var(--primary-brown); padding-left: 12px; margin-bottom: 15px; }
        .supper-box { background-color: #FAF7F2; border: 1px dashed #D9CFC7; border-radius: 1rem; padding: 1rem; margin-top: 1rem; }
        .btn-milk-tea { background-color: var(--primary-brown); color: white; border-radius: 0.75rem; }
        #callModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 9999; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(4px); }
        .dot-flashing { position: relative; width: 6px; height: 6px; border-radius: 5px; background-color: var(--primary-brown); animation: dot-flashing 1s infinite linear alternate; animation-delay: .5s; }
        .dot-flashing::before, .dot-flashing::after { content: ''; display: inline-block; position: absolute; top: 0; }
        .dot-flashing::before { left: -12px; width: 6px; height: 6px; border-radius: 5px; background-color: var(--primary-brown); animation: dot-flashing 1s infinite alternate; animation-delay: 0s; }
        .dot-flashing::after { left: 12px; width: 6px; height: 6px; border-radius: 5px; background-color: var(--primary-brown); animation: dot-flashing 1s infinite alternate; animation-delay: 1s; }
        @keyframes dot-flashing { 0% { background-color: var(--primary-brown); } 50%, 100% { background-color: #EBE3DB; } }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen">

    <header>
        <h1 class="text-xl font-bold tracking-widest text-[#5D4E46]">SEOUL 2026 æ˜¥å­£</h1>
        <div class="flex justify-center gap-4 mt-2 text-[10px] font-bold">
            <span id="headerTemp"><i class="fa fa-cloud-sun mr-1"></i> è®€å–å¤©æ°£ä¸­...</span>
            <span><i class="fa fa-bus mr-1"></i> 6001 æ©Ÿå ´å·´å£«</span>
        </div>
    </header>

    <main class="main-scroll-area" id="mainScroll">
        <!-- TAB 1: è¡Œç¨‹ -->
        <div id="itinerary" class="tab-content active-content">
            <div class="cream-card bg-[#E3F2FD] border-none">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-sm font-bold text-[#1976D2]"><i class="fa fa-cloud-sun mr-2"></i>å³æ™‚ç©¿è¡£èˆ‡å¤©æ°£é å ±</h3>
                    <button onclick="getAIWeather()" class="text-[10px] bg-white px-2 py-1 rounded text-blue-600 font-bold">æ›´æ–°</button>
                </div>
                <div id="weatherLoader" class="hidden py-4 flex justify-center"><div class="dot-flashing"></div></div>
                <div id="weatherDisplay" class="text-[11px] text-blue-800 leading-relaxed">æ­£åœ¨åˆ†æ 2026/03 å¤©æ°£æ¦‚æ³...</div>
            </div>

            <!-- DAY 1-5 è¡Œç¨‹ -->
            <div class="cream-card">
                <div class="day-header"><h2 class="text-lg font-bold text-[#8A7A70]">DAY 1 <span class="text-xs ml-1">03/15 (æ—¥)</span></h2></div>
                <div class="space-y-3 text-sm">
                    <p>âœˆï¸ <strong>11:30</strong> æŠµé”ä»å·æ©Ÿå ´ (ICN)</p>
                    <p>ğŸšŒ <strong>äº¤é€š</strong> 6001 å·´å£«è‡³æ±å¤§é–€é£¯åº—</p>
                    <p>ğŸ¥™ <strong>ä¸‹åˆ</strong> ã€å»£è—å¸‚å ´ã€‘ç”Ÿç‰›è‚‰ã€ç¶ è±†é¤…</p>
                    <p>ğŸ² <strong>æ™šé¤</strong> ã€é™³ç‰è¯ä¸€éš»é›ã€‘ <button onclick="triggerCall('é™³ç‰è¯ä¸€éš»é›', '+82222759666')" class="text-blue-500 underline text-[10px] ml-1">æ’¥æ‰“</button></p>
                </div>
            </div>

            <div class="cream-card">
                <div class="day-header"><h2 class="text-lg font-bold text-[#8A7A70]">DAY 2 <span class="text-xs ml-1">03/16 (ä¸€)</span></h2></div>
                <div class="space-y-3 text-sm">
                    <p>â›©ï¸ <strong>ä¸Šåˆ</strong> ã€æ™¯ç¦å®®ã€‘éŸ“æœé«”é©—</p>
                    <p>ğŸ¥£ <strong>åˆé¤</strong> ã€åœŸä¿—æ‘åƒé›æ¹¯ã€‘ <button onclick="triggerCall('åœŸä¿—æ‘åƒé›æ¹¯', '+8227377444')" class="text-blue-500 underline text-[10px] ml-1">æ’¥æ‰“</button></p>
                    <p>ğŸ˜ï¸ <strong>ä¸‹åˆ</strong> åŒ—æ‘éŸ“å±‹æ‘ â” ä¸‰æ¸…æ´</p>
                    <p>ğŸ—¼ <strong>æ™šä¸Š</strong> ã€å—å±±é¦–çˆ¾å¡”ã€‘å¤œæ™¯</p>
                </div>
            </div>

            <div class="cream-card">
                <div class="day-header"><h2 class="text-lg font-bold text-[#8A7A70]">DAY 3 <span class="text-xs ml-1">03/17 (äºŒ)</span></h2></div>
                <div class="space-y-3 text-sm">
                    <p>ğŸ§º <strong>ä¸Šåˆ</strong> ã€æœ›é å¸‚å ´ã€‘ç¾é£Ÿæ¢éšª</p>
                    <p>ğŸ¸ <strong>ä¸‹åˆ</strong> ã€å¼˜å¤§å•†åœˆã€‘é€›è¡—</p>
                    <p>ğŸ”¥ <strong>æ™šé¤</strong> ã€å°è±¬å­˜éŒ¢ç­’ã€‘çƒ¤è‚‰ <button onclick="triggerCall('å°è±¬å­˜éŒ¢ç­’', '+8223236292')" class="text-blue-500 underline text-[10px] ml-1">æ’¥æ‰“</button></p>
                </div>
            </div>

            <div class="cream-card">
                <div class="day-header"><h2 class="text-lg font-bold text-[#8A7A70]">DAY 4 <span class="text-xs ml-1">03/18 (ä¸‰)</span></h2></div>
                <div class="space-y-3 text-sm">
                    <p>ğŸ¥¯ <strong>ä¸Šåˆ</strong> ã€ç›Šå–„æ´ã€‘éŸ“å±‹å’–å•¡å»³</p>
                    <p>ğŸ’„ <strong>ä¸‹åˆ</strong> ã€æ˜æ´å•†åœˆã€‘è³¼ç‰©ã€Olive Young</p>
                    <p>ğŸ¥© <strong>æ™šé¤</strong> ã€è’è¬¬çš„ç”Ÿè‚‰ã€‘çƒ¤è‚‰ <button onclick="triggerCall('è’è¬¬çš„ç”Ÿè‚‰', '+8227788882')" class="text-blue-500 underline text-[10px] ml-1">æ’¥æ‰“</button></p>
                </div>
            </div>

            <div class="cream-card">
                <div class="day-header"><h2 class="text-lg font-bold text-[#8A7A70]">DAY 5 <span class="text-xs ml-1">03/19 (å››)</span></h2></div>
                <div class="space-y-3 text-sm">
                    <p>ğŸ <strong>ä¸Šåˆ</strong> ã€å—å¤§é–€å¸‚å ´ã€‘è‰è“ä¹¾</p>
                    <p>ğŸœ <strong>åˆé¤</strong> å—å¤§é–€åˆ€å‰Šéºµä¸€æ¢è¡—</p>
                    <p>âœˆï¸ <strong>20:15</strong> ä»å·èµ·é£›å›å°</p>
                </div>
            </div>

            <!-- å®µå¤œæ¨è–¦å€å¡Š -->
            <div class="supper-box">
                <h3 class="text-sm font-bold text-[#A68F80] mb-3"><i class="fa fa-moon mr-2"></i>æ·±å¤œæ¶ˆå¤œæ¨è–¦</h3>
                <div class="space-y-4">
                    <div class="border-b border-[#EBE3DB] pb-3">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-bold">æ©‹æ‘ç‚¸é› (æ±å¤§é–€1è™Ÿåº—)</p>
                                <p class="text-[10px] text-gray-400 mt-1">24å°æ™‚ç‡Ÿæ¥­ï¼Œèœ‚èœœ/å¤§è’œå£å‘³æ¨è–¦</p>
                            </div>
                            <button onclick="triggerCall('æ©‹æ‘ç‚¸é›', '+82222319337')" class="text-[10px] text-blue-500 font-bold">æ’¥æ‰“</button>
                        </div>
                    </div>
                    <div class="border-b border-[#EBE3DB] pb-3">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-bold">å­”é™µä¸€éš»é› (æ±å¤§é–€)</p>
                                <p class="text-[10px] text-gray-400 mt-1">æœ€å¾Œé»é¤ 22:30ï¼Œæ¹¯é ­é®®ç”œ</p>
                            </div>
                            <button onclick="triggerCall('å­”é™µä¸€éš»é›', '+82222696069')" class="text-[10px] text-blue-500 font-bold">æ’¥æ‰“</button>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-bold">æ±å¤§é–€çµå¥‡è¾£ç‚’å¹´ç³•</p>
                                <p class="text-[10px] text-gray-400 mt-1">ç‡Ÿæ¥­è‡³å‡Œæ™¨ï¼Œè¾£åº¦æ¥µé«˜è«‹å°å¿ƒ</p>
                            </div>
                            <button onclick="triggerCall('çµå¥‡è¾£ç‚’å¹´ç³•', '+82222348591')" class="text-[10px] text-blue-500 font-bold">æ’¥æ‰“</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: è¨˜å¸³ -->
        <div id="money" class="tab-content">
            <div class="cream-card">
                <h3 class="text-sm font-bold mb-4 flex items-center"><i class="fa fa-calculator mr-2"></i> å¿«é€Ÿæ›ç®— (1:42.5)</h3>
                <div class="flex flex-col gap-3 bg-[#FDFBF9] p-3 rounded-xl border border-[#EBE3DB]">
                    <div class="flex items-center gap-2">
                        <span class="w-12 text-[10px] text-gray-400 font-bold text-center">KRW</span>
                        <input type="number" id="krwInput" placeholder="è¼¸å…¥éŸ“å…ƒ" class="flex-1 text-lg font-bold outline-none bg-transparent" oninput="calcToTwd()">
                    </div>
                    <div class="flex items-center gap-2 border-t pt-2">
                        <span class="w-12 text-[10px] text-[#A68F80] font-bold text-center">TWD</span>
                        <input type="text" id="twdResult" placeholder="å°å¹£é‡‘é¡" class="flex-1 text-lg font-bold text-[#A68F80] outline-none bg-transparent" readonly>
                    </div>
                </div>
            </div>
            <div class="cream-card">
                <div class="flex justify-between items-center mb-4"><h3 class="text-sm font-bold">æ¶ˆè²»ç´€éŒ„</h3><button onclick="clearExpenses()" class="text-[10px] text-red-400 underline">æ¸…ç©º</button></div>
                <div id="expList" class="space-y-2 mb-4"></div>
                <div class="space-y-3 mb-4">
                    <input type="text" id="expNote" placeholder="é …ç›®" class="w-full text-xs border p-3 rounded-lg outline-none">
                    <div class="flex gap-2"><input type="number" id="expAmount" placeholder="é‡‘é¡ (â‚©)" class="flex-1 text-xs border p-3 rounded-lg outline-none"><button onclick="addExp()" class="btn-milk-tea px-6 text-xs font-bold">æ–°å¢</button></div>
                </div>
                <div class="bg-[#EBE3DB] p-4 rounded-2xl flex justify-between items-center">
                    <div><p class="text-[10px] opacity-60">KRW</p><p id="expTotal" class="font-bold">â‚© 0</p></div>
                    <div class="text-right"><p class="text-[10px] opacity-60">TWD</p><p id="twdTotal" class="text-lg font-bold">NT$ 0</p></div>
                </div>
            </div>
        </div>

        <!-- TAB 3: AIåŠ©ç† (ç¿»è­¯èˆ‡å¸¸ç”¨èª) -->
        <div id="help" class="tab-content space-y-4">
            <div class="cream-card bg-[#F2EDE9] border-none">
                <h3 class="text-sm font-bold mb-3"><i class="fa fa-robot mr-2 text-blue-500"></i> AI éŸ“èªæºé€š</h3>
                <textarea id="translateInput" rows="2" placeholder="ä¾‹å¦‚ï¼šé€™å¤šå°‘éŒ¢ï¼Ÿå¯ä»¥é€€ç¨…å—ï¼Ÿ" class="w-full text-xs border p-3 rounded-xl outline-none mb-3 resize-none"></textarea>
                <button onclick="translateText()" class="w-full btn-milk-tea p-3 text-sm font-bold">ç«‹å³ç¿»è­¯</button>
                <div id="translateResult" class="hidden mt-4 p-4 bg-white rounded-2xl shadow-sm">
                    <div id="tLoader" class="hidden flex justify-center py-4"><div class="dot-flashing"></div></div>
                    <div id="tContent">
                        <p id="koreanText" class="text-xl font-bold text-blue-900"></p>
                        <p id="pinyinText" class="text-xs text-blue-500 italic mt-1"></p>
                    </div>
                    <p id="tError" class="hidden text-xs text-red-500 mt-2 text-center"></p>
                </div>
            </div>

            <div class="cream-card">
                <h3 class="text-sm font-bold mb-4 flex items-center"><i class="fa fa-comments mr-2 text-orange-400"></i> æ—…éŠå¸¸ç”¨å°è©±</h3>
                <div class="space-y-4">
                    <div>
                        <p class="text-[10px] font-bold text-gray-400 mb-2">ğŸ½ï¸ é¤å»³èˆ‡é£²é£Ÿ</p>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="quickTranslate('è«‹å•é€™å¤šå°‘éŒ¢ï¼Ÿ')" class="text-[10px] bg-gray-100 px-3 py-2 rounded-lg">å¤šå°‘éŒ¢ï¼Ÿ</button>
                            <button onclick="quickTranslate('è«‹çµ¦æˆ‘èœå–®ã€‚')" class="text-[10px] bg-gray-100 px-3 py-2 rounded-lg">è«‹çµ¦æˆ‘èœå–®</button>
                            <button onclick="quickTranslate('æˆ‘ä¸åƒè¾£ï¼Œè¬è¬ã€‚')" class="text-[10px] bg-gray-100 px-3 py-2 rounded-lg">ä¸åƒè¾£</button>
                            <button onclick="quickTranslate('è«‹çµ¦æˆ‘æ°´ã€‚')" class="text-[10px] bg-gray-100 px-3 py-2 rounded-lg">è«‹çµ¦æˆ‘æ°´</button>
                        </div>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-gray-400 mb-2">ğŸ›ï¸ è³¼ç‰©èˆ‡é€€ç¨…</p>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="quickTranslate('è«‹å•å¯ä»¥é€€ç¨…å—ï¼Ÿ')" class="text-[10px] bg-gray-100 px-3 py-2 rounded-lg">å¯ä»¥é€€ç¨…å—ï¼Ÿ</button>
                            <button onclick="quickTranslate('å¯ä»¥è©¦ç©¿å—ï¼Ÿ')" class="text-[10px] bg-gray-100 px-3 py-2 rounded-lg">å¯ä»¥è©¦ç©¿å—ï¼Ÿ</button>
                        </div>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-gray-400 mb-2">ğŸ¨ äº¤é€šèˆ‡é£¯åº—</p>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="quickTranslate('è«‹å•æ´—æ‰‹é–“åœ¨å“ªè£¡ï¼Ÿ')" class="text-[10px] bg-gray-100 px-3 py-2 rounded-lg">æ´—æ‰‹é–“åœ¨å“ªï¼Ÿ</button>
                            <button onclick="quickTranslate('æˆ‘è¦è¾¦ç†å…¥ä½æ‰‹çºŒã€‚')" class="text-[10px] bg-gray-100 px-3 py-2 rounded-lg">è¾¦ç†å…¥ä½</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 4: æ¸…å–® -->
        <div id="prep" class="tab-content">
            <div class="cream-card">
                <h3 class="text-sm font-bold mb-4">è¡Œå‰ Check</h3>
                <div id="checkList" class="space-y-2"></div>
                <div class="mt-4 flex gap-2">
                    <input type="text" id="newPrep" placeholder="æ–°å¢..." class="flex-1 text-xs border p-3 rounded-lg">
                    <button onclick="addPrep()" class="btn-milk-tea px-4"><i class="fa fa-plus"></i></button>
                </div>
            </div>
        </div>
    </main>

    <!-- æ’¥è™Ÿ Modal -->
    <div id="callModal">
        <div class="bg-white p-6 rounded-3xl w-full max-w-[280px] text-center shadow-2xl">
            <h4 id="callName" class="font-bold text-lg mb-2 text-[#5D4E46]">æ’¥æ‰“é›»è©±</h4>
            <p id="callNum" class="text-blue-500 font-mono mb-6 text-xl"></p>
            <div class="flex gap-3">
                <button onclick="closeCallModal()" class="flex-1 py-3 bg-gray-100 rounded-xl font-bold">å–æ¶ˆ</button>
                <a id="realCall" href="#" class="flex-1 py-3 btn-milk-tea rounded-xl font-bold text-white block">æ’¥æ‰“</a>
            </div>
        </div>
    </div>

    <nav class="fixed bottom-0 max-w-md w-full bg-white border-t py-3 flex justify-around items-center z-50">
        <button onclick="switchTab('itinerary', this)" class="flex flex-col items-center gap-1 active-tab text-[#BCAC9B]">
            <i class="fa fa-map-marked-alt text-lg"></i><span class="text-[9px] font-bold">è¡Œç¨‹</span>
        </button>
        <button onclick="switchTab('money', this)" class="flex flex-col items-center gap-1 text-[#BCAC9B]">
            <i class="fa fa-wallet text-lg"></i><span class="text-[9px] font-bold">è¨˜å¸³</span>
        </button>
        <button onclick="switchTab('help', this)" class="flex flex-col items-center gap-1 text-[#BCAC9B]">
            <i class="fa fa-robot text-lg"></i><span class="text-[9px] font-bold">åŠ©ç†</span>
        </button>
        <button onclick="switchTab('prep', this)" class="flex flex-col items-center gap-1 text-[#BCAC9B]">
            <i class="fa fa-list-check text-lg"></i><span class="text-[9px] font-bold">æ¸…å–®</span>
        </button>
    </nav>

    <script>
        const apiKey = ""; 
        const RATE = 42.5;

        async function callGemini(prompt, system = "", isJson = false) {
            const maxRetries = 5;
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: system ? { parts: [{ text: system }] } : undefined
            };
            if (isJson) {
                payload.generationConfig = { 
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            korean: { type: "STRING" },
                            pinyin: { type: "STRING" }
                        }
                    }
                };
            }
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "";
                } catch (e) {
                    if (i === maxRetries - 1) throw e;
                    await new Promise(r => setTimeout(r, 1000 * Math.pow(2, i)));
                }
            }
        }

        async function getAIWeather() {
            const display = document.getElementById('weatherDisplay');
            const loader = document.getElementById('weatherLoader');
            loader.classList.remove('hidden'); display.classList.add('hidden');
            try {
                const res = await callGemini("é‡å°é¦–çˆ¾ 2026å¹´3æœˆä¸­æ—¬æä¾›ä¸€æ®µç©¿è¡£å»ºè­°èˆ‡é æ¸¬æ°£æº«ï¼Œè«‹ç”¨ç¹é«”ä¸­æ–‡ç°¡çŸ­å›è¦†ã€‚");
                display.innerText = res || "å»ºè­°æ´‹è”¥å¼ç©¿æ³•ï¼Œç™½å¤©æ¶¼çˆ½æ™šä¸Šå¯’å†·ã€‚";
                document.getElementById('headerTemp').innerHTML = `<i class="fa fa-thermometer-half mr-1"></i>é æ¸¬ 8Â°C ~ 16Â°C`;
            } catch (e) { display.innerText = "å»ºè­°æ´‹è”¥å¼ç©¿æ³•ã€‚"; }
            finally { loader.classList.add('hidden'); display.classList.remove('hidden'); }
        }

        async function translateText() {
            const input = document.getElementById('translateInput').value.trim();
            if (!input) return;
            const resBox = document.getElementById('translateResult');
            const loader = document.getElementById('tLoader');
            const content = document.getElementById('tContent');
            const errorLabel = document.getElementById('tError');
            resBox.classList.remove('hidden'); loader.classList.remove('hidden'); content.classList.add('hidden'); errorLabel.classList.add('hidden');
            try {
                const res = await callGemini(`å°‡æ­¤æ®µè©±ç¿»è­¯æˆéŸ“æ–‡ï¼Œä¸¦æä¾›éŸ“æ–‡æ‹¼éŸ³ï¼š${input}`, "ä½ æ˜¯ä¸€å€‹éŸ“æ–‡ç¿»è­¯åŠ©ç†ã€‚è«‹å›å‚³åŒ…å« korean èˆ‡ pinyin çš„ JSON ç‰©ä»¶ã€‚", true);
                const data = JSON.parse(res);
                document.getElementById('koreanText').innerText = data.korean;
                document.getElementById('pinyinText').innerText = data.pinyin;
                loader.classList.add('hidden'); content.classList.remove('hidden');
            } catch (e) {
                loader.classList.add('hidden');
                errorLabel.innerText = "ç¿»è­¯æœå‹™æš«æ™‚ä¸å¯ç”¨ã€‚";
                errorLabel.classList.remove('hidden');
            }
        }

        function quickTranslate(text) {
            document.getElementById('translateInput').value = text;
            translateText();
        }

        function triggerCall(name, num) {
            document.getElementById('callName').innerText = name;
            document.getElementById('callNum').innerText = num;
            document.getElementById('realCall').href = `tel:${num}`;
            document.getElementById('callModal').style.display = 'flex';
        }
        function closeCallModal() { document.getElementById('callModal').style.display = 'none'; }

        // è¨˜å¸³èˆ‡æ¸…å–®ç³»çµ±
        let expenses = JSON.parse(localStorage.getItem('seoul_v15_exp')) || [];
        function updateExpUI() {
            const list = document.getElementById('expList'); list.innerHTML = '';
            let total = 0;
            expenses.forEach((exp, i) => {
                const div = document.createElement('div');
                div.className = "flex justify-between text-xs p-2 border-b items-center";
                div.innerHTML = `<span class="text-gray-600">${exp.note}</span><span>â‚©${parseInt(exp.amt).toLocaleString()} <button onclick="removeExp(${i})" class="ml-2 text-red-300">Ã—</button></span>`;
                list.appendChild(div);
                total += parseInt(exp.amt);
            });
            document.getElementById('expTotal').innerText = `â‚© ${total.toLocaleString()}`;
            document.getElementById('twdTotal').innerText = `NT$ ${Math.round(total/RATE).toLocaleString()}`;
            localStorage.setItem('seoul_v15_exp', JSON.stringify(expenses));
        }
        function addExp() {
            const n = document.getElementById('expNote').value, a = document.getElementById('expAmount').value;
            if(!a) return;
            expenses.unshift({note: n || 'ä¸€èˆ¬æ¶ˆè²»', amt: a});
            document.getElementById('expNote').value = ''; document.getElementById('expAmount').value = '';
            updateExpUI();
        }
        function removeExp(i){ expenses.splice(i,1); updateExpUI(); }
        function clearExpenses(){ if(confirm('è¦æ¸…ç©ºæ‰€æœ‰ç´€éŒ„å—ï¼Ÿ')){expenses=[]; updateExpUI();}}
        function calcToTwd() {
            const v = document.getElementById('krwInput').value;
            document.getElementById('twdResult').value = v ? 'â‰ˆ NT$ ' + Math.round(v/RATE).toLocaleString() : '';
        }

        let prep = JSON.parse(localStorage.getItem('seoul_v15_prep')) || [
            {t: "è­·ç…§èˆ‡ K-ETA", c: true}, {t: "WOWPASS å¡", c: false}, {t: "220V è½‰æ¥é ­", c: false}
        ];
        function updatePrepUI() {
            const list = document.getElementById('checkList'); list.innerHTML = '';
            prep.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = "flex items-center gap-2 p-2 border-b text-sm";
                div.innerHTML = `<input type="checkbox" ${item.c?'checked':''} onchange="tp(${i})"> <span class="${item.c?'line-through opacity-40':''}">${item.t}</span>`;
                list.appendChild(div);
            });
            localStorage.setItem('seoul_v15_prep', JSON.stringify(prep));
        }
        function tp(i){ prep[i].c = !prep[i].c; updatePrepUI(); }
        function addPrep(){ const v = document.getElementById('newPrep').value; if(v){prep.push({t:v,c:false}); document.getElementById('newPrep').value=''; updatePrepUI();}}

        function switchTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-content'));
            document.getElementById(id).classList.add('active-content');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-tab'));
            el.classList.add('active-tab');
        }

        window.onload = () => { updateExpUI(); updatePrepUI(); getAIWeather(); };
    </script>
</body>
</html>
